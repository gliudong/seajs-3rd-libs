define("ucloud/backgrid/0.2.6/backgrid",["gallery/backbone/1.0.0/backbone","gallery/underscore/1.4.4/underscore","$","ucloud/jquery/1.8.2/jquery"],function(e,t,i){function n(e){return String.fromCharCode(e.charCodeAt(0)-32)+e.slice(1)}function r(e,t,i){var n=t-(e+"").length;n=0>n?0:n;for(var r="",o=0;n>o;o++)r+=i;return r+e}var o=e("gallery/backbone/1.0.0/backbone"),s=e("gallery/underscore/1.4.4/underscore"),l=e("ucloud/jquery/1.8.2/jquery"),a="	\n\f\r   ᠎             　\u2028\u2029";if(!String.prototype.trim||a.trim()){a="["+a+"]";var c=RegExp("^"+a+a+"*"),h=RegExp(a+a+"*$");String.prototype.trim=function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");return(this+"").replace(c,"").replace(h,"")}}var d={VERSION:"0.2.6",Extension:{},requireOptions:function(e,t){for(var i=0;t.length>i;i++){var n=t[i];if(s.isUndefined(e[n]))throw new TypeError("'"+n+"' is required")}},resolveNameToClass:function(e,t){if(s.isString(e)){var i=s.map(e.split("-"),function(e){return n(e)}).join("")+t,r=d[i]||d.Extension[i];if(s.isUndefined(r))throw new ReferenceError("Class '"+i+"' not found");return r}return e}};s.extend(d,o.Events);var u=d.Command=function(e){s.extend(this,{altKey:!!e.altKey,"char":e.char,charCode:e.charCode,ctrlKey:!!e.ctrlKey,key:e.key,keyCode:e.keyCode,locale:e.locale,location:e.location,metaKey:!!e.metaKey,repeat:!!e.repeat,shiftKey:!!e.shiftKey,which:e.which})};s.extend(u.prototype,{moveUp:function(){return 38==this.keyCode},moveDown:function(){return 40===this.keyCode},moveLeft:function(){return this.shiftKey&&9===this.keyCode},moveRight:function(){return!this.shiftKey&&9===this.keyCode},save:function(){return 13===this.keyCode},cancel:function(){return 27===this.keyCode},passThru:function(){return!(this.moveUp()||this.moveDown()||this.moveLeft()||this.moveRight()||this.save()||this.cancel())}});var m=d.CellFormatter=function(){};s.extend(m.prototype,{fromRaw:function(e){return e.get("name")},toRaw:function(e){return e}});var p=d.NumberFormatter=function(e){if(e=e?s.clone(e):{},s.extend(this,this.defaults,e),0>this.decimals||this.decimals>20)throw new RangeError("decimals must be between 0 and 20")};p.prototype=new m,s.extend(p.prototype,{defaults:{decimals:2,decimalSeparator:".",orderSeparator:","},HUMANIZED_NUM_RE:/(\d)(?=(?:\d{3})+$)/g,fromRaw:function(e){if(s.isNull(e)||s.isUndefined(e))return"";e=e.toFixed(~~this.decimals);var t=e.split("."),i=t[0],n=t[1]?(this.decimalSeparator||".")+t[1]:"";return i.replace(this.HUMANIZED_NUM_RE,"$1"+this.orderSeparator)+n},toRaw:function(e){for(var t="",i=e.trim().split(this.orderSeparator),n=0;i.length>n;n++)t+=i[n];var r=t.split(this.decimalSeparator);t="";for(var n=0;r.length>n;n++)t=t+r[n]+".";"."===t[t.length-1]&&(t=t.slice(0,t.length-1));var o=1*(1*t).toFixed(~~this.decimals);return s.isNumber(o)&&!s.isNaN(o)?o:void 0}});var f=d.DatetimeFormatter=function(e){if(e=e?s.clone(e):{},s.extend(this,this.defaults,e),!this.includeDate&&!this.includeTime)throw Error("Either includeDate or includeTime must be true")};f.prototype=new m,s.extend(f.prototype,{defaults:{includeDate:!0,includeTime:!0,includeMilli:!1},DATE_RE:/^([+\-]?\d{4})-(\d{2})-(\d{2})$/,TIME_RE:/^(\d{2}):(\d{2}):(\d{2})(\.(\d{3}))?$/,ISO_SPLITTER_RE:/T|Z| +/,_convert:function(e,t){var i,n=null;if(s.isNumber(e)){var o=new Date(e);i=r(o.getUTCFullYear(),4,0)+"-"+r(o.getUTCMonth()+1,2,0)+"-"+r(o.getUTCDate(),2,0),n=r(o.getUTCHours(),2,0)+":"+r(o.getUTCMinutes(),2,0)+":"+r(o.getUTCSeconds(),2,0)}else{e=e.trim();var l=e.split(this.ISO_SPLITTER_RE)||[];i=this.DATE_RE.test(l[0])?l[0]:"",n=i&&l[1]?l[1]:this.TIME_RE.test(l[0])?l[0]:""}var a=this.DATE_RE.exec(i)||[],c=this.TIME_RE.exec(n)||[];if(t){if(this.includeDate&&s.isUndefined(a[0]))return;if(this.includeTime&&s.isUndefined(c[0]))return;if(!this.includeDate&&i)return;if(!this.includeTime&&n)return}var o=new Date(Date.UTC(1*a[1]||0,1*a[2]-1||0,1*a[3]||0,1*c[1]||null,1*c[2]||null,1*c[3]||null,1*c[5]||null)),h="";return this.includeDate&&(h=r(o.getUTCFullYear(),4,0)+"-"+r(o.getUTCMonth()+1,2,0)+"-"+r(o.getUTCDate(),2,0)),this.includeTime&&(h=h+(this.includeDate?"T":"")+r(o.getUTCHours(),2,0)+":"+r(o.getUTCMinutes(),2,0)+":"+r(o.getUTCSeconds(),2,0),this.includeMilli&&(h=h+"."+r(o.getUTCMilliseconds(),3,0))),this.includeDate&&this.includeTime&&(h+="Z"),h},fromRaw:function(e){return s.isNull(e)||s.isUndefined(e)?"":this._convert(e)},toRaw:function(e){return this._convert(e,!0)}});var g=d.StringFormatter=function(){};g.prototype=new m,s.extend(g.prototype,{fromRaw:function(e,t){var i=e.get(t.get("name"));return s.isUndefined(i)||s.isNull(i)?"":i+""}});var v=d.EmailFormatter=function(){};v.prototype=new m,s.extend(v.prototype,{toRaw:function(e){var t=e.trim().split("@");return 2===t.length&&s.all(t)?e:void 0}});var w=d.SelectFormatter=function(){};w.prototype=new m,s.extend(w.prototype,{fromRaw:function(e){return s.isArray(e)?e:null!=e?[e]:[]}});var y=d.CellEditor=o.View.extend({initialize:function(e){d.requireOptions(e,["formatter","column","model"]),this.formatter=e.formatter,this.column=e.column,this.column instanceof R||(this.column=new R(this.column)),this.listenTo(this.model,"backgrid:editing",this.postRender)},postRender:function(e,t){return(null==t||t.get("name")==this.column.get("name"))&&this.$el.focus(),this}}),b=d.InputCellEditor=y.extend({tagName:"input",attributes:{type:"text"},events:{blur:"saveOrCancel",keydown:"saveOrCancel"},initialize:function(e){y.prototype.initialize.apply(this,arguments),e.placeholder&&this.$el.attr("placeholder",e.placeholder)},render:function(){return this.$el.val(this.formatter.fromRaw(this.model,this.column)),this},saveOrCancel:function(e){var t=this.formatter,i=this.model,n=this.column,r=new u(e),o="blur"===e.type;if(r.moveUp()||r.moveDown()||r.moveLeft()||r.moveRight()||r.save()||o){e.preventDefault(),e.stopPropagation();var l=this.$el.val(),a=t.toRaw(l);s.isUndefined(a)?i.trigger("backgrid:error",i,n,l):n.get("editCommandHandler")?n.get("editCommandHandler")(i,n,r,l):i.trigger("backgrid:edited",i,n,r)}else r.cancel()&&(e.stopPropagation(),i.trigger("backgrid:edited",i,n,r))},postRender:function(e,t){if(null==t||t.get("name")==this.column.get("name"))if("right"===this.$el.css("text-align")){var i=this.$el.val();this.$el.focus().val(null).val(i)}else this.$el.focus();return this}}),x=d.Cell=o.View.extend({tagName:"td",formatter:new m,editor:b,events:{click:"enterEditMode"},initialize:function(e){d.requireOptions(e,["model","column"]),this.column=e.column,this.column instanceof R||(this.column=new R(this.column)),this.formatter=d.resolveNameToClass(this.column.get("formatter")||this.formatter,"Formatter"),this.editor=d.resolveNameToClass(this.editor,"CellEditor"),this.listenTo(this.model,"change:"+this.column.get("name"),function(){this.$el.hasClass("editor")||this.render()}),this.listenTo(this.model,"backgrid:error",this.renderError)},render:function(){return this.$el.empty(),this.$el.html(this.formatter.fromRaw(this.model,this.column)),this.delegateEvents(),this.column.get("editable")&&this.$el.addClass("editable"),this},enterEditMode:function(){var e=this.model,t=this.column;t.get("editable")&&(this.currentEditor=new this.editor({column:this.column,model:this.model,formatter:this.formatter}),e.trigger("backgrid:edit",e,t,this,this.currentEditor),this.undelegateEvents(),this.$el.empty(),this.$el.append(this.currentEditor.$el),this.currentEditor.render(),this.$el.addClass("editor"),e.trigger("backgrid:editing",e,t,this,this.currentEditor))},renderError:function(e,t){(null==t||t.get("name")==this.column.get("name"))&&this.$el.addClass("error")},exitEditMode:function(){this.$el.removeClass("error"),this.currentEditor.remove(),this.stopListening(this.currentEditor),delete this.currentEditor,this.$el.removeClass("editor"),this.render()},remove:function(){return this.currentEditor&&(this.currentEditor.remove.apply(this,arguments),delete this.currentEditor),o.View.prototype.remove.apply(this,arguments)}}),C=d.StringCell=x.extend({className:"string-cell",formatter:new g});d.UriCell=x.extend({className:"uri-cell",render:function(){this.$el.empty();var e=this.formatter.fromRaw(this.model.get(this.column.get("name")));return this.$el.append(l("<a>",{tabIndex:-1,href:e,title:e,target:"_blank"}).text(e)),this.delegateEvents(),this}}),d.EmailCell=C.extend({className:"email-cell",formatter:new v,render:function(){this.$el.empty();var e=this.formatter.fromRaw(this.model.get(this.column.get("name")));return this.$el.append(l("<a>",{tabIndex:-1,href:"mailto:"+e,title:e}).text(e)),this.delegateEvents(),this}});var E=d.NumberCell=x.extend({className:"number-cell",decimals:p.prototype.defaults.decimals,decimalSeparator:p.prototype.defaults.decimalSeparator,orderSeparator:p.prototype.defaults.orderSeparator,formatter:p,initialize:function(){x.prototype.initialize.apply(this,arguments),this.formatter=new this.formatter({decimals:this.decimals,decimalSeparator:this.decimalSeparator,orderSeparator:this.orderSeparator})}});d.IntegerCell=E.extend({className:"integer-cell",decimals:0});var T=d.DatetimeCell=x.extend({className:"datetime-cell",includeDate:f.prototype.defaults.includeDate,includeTime:f.prototype.defaults.includeTime,includeMilli:f.prototype.defaults.includeMilli,formatter:f,initialize:function(){x.prototype.initialize.apply(this,arguments),this.formatter=new this.formatter({includeDate:this.includeDate,includeTime:this.includeTime,includeMilli:this.includeMilli});var e=this.includeDate?"YYYY-MM-DD":"";e+=this.includeDate&&this.includeTime?"T":"",e+=this.includeTime?"HH:mm:ss":"",e+=this.includeTime&&this.includeMilli?".SSS":"",this.editor=this.editor.extend({attributes:s.extend({},this.editor.prototype.attributes,this.editor.attributes,{placeholder:e})})}});d.DateCell=T.extend({className:"date-cell",includeTime:!1}),d.TimeCell=T.extend({className:"time-cell",includeDate:!1});var k=d.BooleanCellEditor=y.extend({tagName:"input",attributes:{tabIndex:-1,type:"checkbox"},events:{mousedown:function(){this.mouseDown=!0},blur:"enterOrExitEditMode",mouseup:function(){this.mouseDown=!1},change:"saveOrCancel",keydown:"saveOrCancel"},render:function(){var e=this.formatter.fromRaw(this.model.get(this.column.get("name")));return this.$el.prop("checked",e),this},enterOrExitEditMode:function(e){if(!this.mouseDown){var t=this.model;t.trigger("backgrid:edited",t,this.column,new u(e))}},saveOrCancel:function(e){var t=this.model,i=this.column,n=this.formatter,r=new u(e);if(r.passThru()&&"change"!=e.type)return!0;r.cancel()&&(e.stopPropagation(),t.trigger("backgrid:edited",t,i,r));var o=this.$el;if(r.save()||r.moveLeft()||r.moveRight()||r.moveUp()||r.moveDown()){e.preventDefault(),e.stopPropagation();var s=n.toRaw(o.prop("checked"));t.set(i.get("name"),s),t.trigger("backgrid:edited",t,i,r)}else if("change"==e.type){var s=n.toRaw(o.prop("checked"));t.set(i.get("name"),s),o.focus()}}});d.BooleanCell=x.extend({className:"boolean-cell",editor:k,events:{click:"enterEditMode"},render:function(){return this.$el.empty(),this.$el.append(l("<input>",{tabIndex:-1,type:"checkbox",checked:this.formatter.fromRaw(this.model.get(this.column.get("name")))})),this.delegateEvents(),this}});var $=d.SelectCellEditor=y.extend({tagName:"select",events:{change:"save",blur:"close",keydown:"close"},template:s.template('<option value="<%- value %>" <%= selected ? \'selected="selected"\' : "" %>><%- text %></option>'),setOptionValues:function(e){this.optionValues=e},setMultiple:function(e){this.multiple=e,this.$el.prop("multiple",e)},_renderOptions:function(e,t){for(var i="",n=0;e.length>n;n++)i+=this.template({text:e[n][0],value:e[n][1],selected:t.indexOf(e[n][1])>-1});return i},render:function(){this.$el.empty();var e=s.result(this,"optionValues"),t=this.formatter.fromRaw(this.model.get(this.column.get("name")));if(!s.isArray(e))throw TypeError("optionValues must be an array");for(var i=null,n=null,i=null,r=null,o=null,a=0;e.length>a;a++){var i=e[a];if(s.isArray(i))n=i[0],i=i[1],this.$el.append(this.template({text:n,value:i,selected:t.indexOf(i)>-1}));else{if(!s.isObject(i))throw TypeError("optionValues elements must be a name-value pair or an object hash of { name: 'optgroup label', value: [option name-value pairs] }");r=i.name,o=l("<optgroup></optgroup>",{label:r}),o.append(this._renderOptions(i.values,t)),this.$el.append(o)}}return this.delegateEvents(),this},save:function(e){var t=this.model,i=this.column;t.set(i.get("name"),this.formatter.toRaw(this.$el.val())),t.trigger("backgrid:edited",t,i,new u(e))},close:function(e){var t=this.model,i=this.column,n=new u(e);n.cancel()?(e.stopPropagation(),t.trigger("backgrid:edited",t,i,new u(e))):(n.save()||n.moveLeft()||n.moveRight()||n.moveUp()||n.moveDown()||"blur"==e.type)&&(e.preventDefault(),e.stopPropagation(),"blur"==e.type&&1===this.$el.find("option").length&&t.set(i.get("name"),this.formatter.toRaw(this.$el.val())),t.trigger("backgrid:edited",t,i,new u(e)))}});d.SelectCell=x.extend({className:"select-cell",editor:$,multiple:!1,formatter:new w,optionValues:void 0,delimiter:", ",initialize:function(){x.prototype.initialize.apply(this,arguments),d.requireOptions(this,["optionValues"]),this.listenTo(this.model,"backgrid:edit",function(e,t,i,n){t.get("name")==this.column.get("name")&&(n.setOptionValues(this.optionValues),n.setMultiple(this.multiple))})},render:function(){this.$el.empty();var e=this.optionValues,t=this.formatter.fromRaw(this.model.get(this.column.get("name"))),i=[];try{if(!s.isArray(e)||s.isEmpty(e))throw new TypeError;for(var n=0;t.length>n;n++)for(var r=t[n],o=0;e.length>o;o++){var l=e[o];if(s.isArray(l)){var a=l[0],l=l[1];l==r&&i.push(a)}else{if(!s.isObject(l))throw new TypeError;for(var c=l.values,h=0;c.length>h;h++){var d=c[h];d[1]==r&&i.push(d[0])}}}this.$el.append(i.join(this.delimiter))}catch(u){if(u instanceof TypeError)throw TypeError("'optionValues' must be of type {Array.<Array>|Array.<{name: string, values: Array.<Array>}>}");throw u}return this.delegateEvents(),this}});var R=d.Column=o.Model.extend({defaults:{name:void 0,label:void 0,sortable:!0,editable:!0,renderable:!0,formatter:void 0,cell:void 0,headerCell:void 0},initialize:function(e){d.requireOptions(e,["cell","name"]),this.has("label")||this.set({label:this.get("name")},{silent:!0});var t=d.resolveNameToClass(this.get("headerCell"),"HeaderCell"),i=d.resolveNameToClass(this.get("cell"),"Cell");this.set({cell:i,headerCell:t},{silent:!0})}}),N=d.Columns=o.Collection.extend({model:R}),D=d.Row=o.View.extend({tagName:"tr",requiredOptions:["columns","model"],initialize:function(e){this.grid=e.grid,d.requireOptions(e,this.requiredOptions);var t=this.columns=e.columns;t instanceof o.Collection||(t=this.columns=new N(t));for(var i=this.cells=[],n=0;t.length>n;n++)i.push(this.makeCell(t.at(n),e));this.listenTo(t,"change:renderable",function(e,t){for(var n=0;i.length>n;n++){var r=i[n];r.column.get("name")==e.get("name")&&(t?r.$el.show():r.$el.hide())}}),this.listenTo(t,"add",function(t,n){var r=n.indexOf(t),o=this.makeCell(t,e);i.splice(r,0,o),o.column.get("renderable")||o.$el.hide();var s=this.$el;0===r?s.prepend(o.render().$el):r===n.length-1?s.append(o.render().$el):s.children().eq(r).before(o.render().$el)}),this.listenTo(t,"remove",function(e,t,n){i[n.index].remove(),i.splice(n.index,1)})},makeCell:function(e){return new(e.get("cell"))({column:e,model:this.model,grid:this.grid})},render:function(){this.$el.empty();for(var e=document.createDocumentFragment(),t=0;this.cells.length>t;t++){var i=this.cells[t];e.appendChild(i.render().el),i.column.get("renderable")||i.$el.hide()}return this.el.appendChild(e),this.delegateEvents(),this},remove:function(){for(var e=0;this.cells.length>e;e++){var t=this.cells[e];t.remove.apply(t,arguments)}return o.View.prototype.remove.apply(this,arguments)}}),M=d.EmptyRow=o.View.extend({tagName:"tr",emptyText:null,initialize:function(e){d.requireOptions(e,["emptyText","columns"]),this.emptyText=e.emptyText,this.columns=e.columns},render:function(){this.$el.empty();var e=document.createElement("td");return e.setAttribute("colspan",this.columns.length),e.textContent=this.emptyText,this.el.setAttribute("class","empty"),this.el.appendChild(e),this}}),O=d.HeaderCell=o.View.extend({tagName:"th",events:{"click a":"onClick"},_direction:null,initialize:function(e){d.requireOptions(e,["column","collection"]),this.column=e.column,this.column instanceof R||(this.column=new R(this.column)),this.listenTo(this.collection,"backgrid:sort",this._resetCellDirection)},direction:function(e){return arguments.length&&(this._direction&&this.$el.removeClass(this._direction),e&&this.$el.addClass(e),this._direction=e),this._direction},_resetCellDirection:function(e,t,i,n){n==this.collection&&(e!==this.column.get("name")?this.direction(null):this.direction(t))},onClick:function(e){e.preventDefault();var t=this.column.get("name");this.column.get("sortable")&&("ascending"===this.direction()?this.sort(t,"descending",function(e,i){var n=e.get(t),r=i.get(t);return n===r?0:n>r?-1:1}):"descending"===this.direction()?this.sort(t,null):this.sort(t,"ascending",function(e,i){var n=e.get(t),r=i.get(t);return n===r?0:r>n?-1:1}))},sort:function(e,t,i){i=i||this._cidComparator;var n=this.collection;if(o.PageableCollection&&n instanceof o.PageableCollection){var r;r="ascending"===t?-1:"descending"===t?1:null,n.setSorting(r?e:null,r),"client"==n.mode?(n.fullCollection.comparator||(n.fullCollection.comparator=i),n.fullCollection.sort()):n.fetch({reset:!0})}else n.comparator=i,n.sort();this.collection.trigger("backgrid:sort",e,t,i,this.collection)},_cidComparator:function(e,t){var i=e.cid,n=t.cid;if(!s.isUndefined(i)&&!s.isUndefined(n)){if(i=1*i.slice(1),n=1*n.slice(1),n>i)return-1;if(i>n)return 1}return 0},render:function(){var e;return this.$el.empty(),e=this.column.get("sortable")?l("<a>").text(this.column.get("label")).append("<b class='sort-caret'></b>"):this.column.get("label"),this.$el.append(e),this.delegateEvents(),this}});d.HeaderRow=d.Row.extend({requiredOptions:["columns","collection"],initialize:function(){d.Row.prototype.initialize.apply(this,arguments)},makeCell:function(e,t){var i=e.get("headerCell")||t.headerCell||O;return i=new i({column:e,collection:this.collection,grid:t.grid})}});var S=d.Header=o.View.extend({tagName:"thead",initialize:function(e){d.requireOptions(e,["columns","collection"]),this.columns=e.columns,this.columns instanceof o.Collection||(this.columns=new N(this.columns)),this.row=new d.HeaderRow({columns:this.columns,collection:this.collection,grid:e.grid})},render:function(){return this.$el.append(this.row.render().$el),this.delegateEvents(),this},remove:function(){return this.row.remove.apply(this.row,arguments),o.View.prototype.remove.apply(this,arguments)}}),U=d.Body=o.View.extend({tagName:"tbody",initialize:function(e){this.grid=e.grid,d.requireOptions(e,["columns","collection"]),this.columns=e.columns,this.columns instanceof o.Collection||(this.columns=new N(this.columns)),this.row=e.row||D,this.rows=this.collection.map(function(e){var t=new this.row({columns:this.columns,model:e,grid:this.grid});return t},this),this.emptyText=e.emptyText,this._unshiftEmptyRowMayBe();var t=this.collection;this.listenTo(t,"add",this.insertRow),this.listenTo(t,"remove",this.removeRow),this.listenTo(t,"sort",this.refresh),this.listenTo(t,"reset",this.refresh),this.listenTo(t,"backgrid:edited",this.moveToNextCell)},_unshiftEmptyRowMayBe:function(){0===this.rows.length&&null!=this.emptyText&&this.rows.unshift(new M({emptyText:this.emptyText,columns:this.columns}))},insertRow:function(e,t,i){if(this.rows[0]instanceof M&&this.rows.pop().remove(),!(t instanceof o.Collection||i))return this.collection.add(e,i=t),void 0;i=s.extend({render:!0},i||{});var n=new this.row({columns:this.columns,model:e,grid:this.grid}),r=t.indexOf(e);this.rows.splice(r,0,n);var l=this.$el,a=l.children(),c=n.render().$el;i.render&&(r>=a.length?l.append(c):a.eq(r).before(c))},removeRow:function(e,t,i){return i?((s.isUndefined(i.render)||i.render)&&this.rows[i.index].remove(),this.rows.splice(i.index,1),this._unshiftEmptyRowMayBe(),void 0):(this.collection.remove(e,i=t),this._unshiftEmptyRowMayBe(),void 0)},refresh:function(){for(var e=0;this.rows.length>e;e++)this.rows[e].remove();return this.rows=this.collection.map(function(e){var t=new this.row({columns:this.columns,model:e,grid:this.grid});return t},this),this._unshiftEmptyRowMayBe(),this.render(),this.collection.trigger("backgrid:refresh",this),this},render:function(){this.$el.empty();for(var e=document.createDocumentFragment(),t=0;this.rows.length>t;t++){var i=this.rows[t];e.appendChild(i.render().el)}return this.el.appendChild(e),this.delegateEvents(),this},remove:function(){for(var e=0;this.rows.length>e;e++){var t=this.rows[e];t.remove.apply(t,arguments)}return o.View.prototype.remove.apply(this,arguments)},moveToNextCell:function(e,t,i){var n=this.collection.indexOf(e),r=this.columns.indexOf(t);if(i.moveUp()||i.moveDown()||i.moveLeft()||i.moveRight()||i.save()){var o=this.columns.length,s=o*this.collection.length;if(i.moveUp()||i.moveDown()){var l=this.rows[n+(i.moveUp()?-1:1)];l&&l.cells[r].enterEditMode()}else if(i.moveLeft()||i.moveRight())for(var a=i.moveRight(),c=n*o+r+(a?1:-1);c>=0&&s>c;a?c++:c--){var h=~~(c/o),d=c-h*o,u=this.rows[h].cells[d];if(u.column.get("renderable")&&u.column.get("editable")){u.enterEditMode();break}}}this.rows[n].cells[r].exitEditMode()}});d.Footer=o.View.extend({tagName:"tfoot",initialize:function(e){d.requireOptions(e,["columns","collection"]),this.columns=e.columns,this.columns instanceof o.Collection||(this.columns=new d.Columns(this.columns))}}),d.Grid=o.View.extend({tagName:"table",className:"backgrid",header:S,body:U,footer:null,initialize:function(e){d.requireOptions(e,["columns","collection"]),e.columns instanceof o.Collection||(e.columns=new N(e.columns)),this.columns=e.columns;var t=s.omit(e,["el","id","attributes","className","tagName","events"]);t=s.extend(t,{grid:this}),this.header=e.header||this.header,this.header=new this.header(t),this.body=e.body||this.body,this.body=new this.body(t),this.footer=e.footer||this.footer,this.footer&&(this.footer=new this.footer(t)),this.listenTo(this.columns,"reset",function(){this.header=new(this.header.remove().constructor)(t),this.body=new(this.body.remove().constructor)(t),this.footer&&(this.footer=new(this.footer.remove().constructor)(t)),this.render()})},insertRow:function(e,t,i){return this.body.insertRow(e,t,i)},removeRow:function(e,t,i){return this.body.removeRow(e,t,i)},insertColumn:function(e,t){return t=t||{render:!0},this.columns.add(e,t),this},removeColumn:function(e,t){return this.columns.remove(e,t),this},render:function(){return this.$el.empty(),this.$el.append(this.header.render().$el),this.footer&&this.$el.append(this.footer.render().$el),this.$el.append(this.body.render().$el),this.delegateEvents(),this.trigger("backgrid:rendered",this),this},remove:function(){return this.header.remove.apply(this.header,arguments),this.body.remove.apply(this.body,arguments),this.footer&&this.footer.remove.apply(this.footer,arguments),o.View.prototype.remove.apply(this,arguments)}});var _=d.Extension.SelectRowCell=o.View.extend({className:"select-row-cell",tagName:"td",events:{"keydown :checkbox":"onKeydown","change :checkbox":"onChange","click :checkbox":"enterEditMode"},initialize:function(e){this.grid=e.grid,d.requireOptions(e,["model","column"]),this.column=e.column,this.column instanceof d.Column||(this.column=new d.Column(this.column)),this.listenTo(this.model,"backgrid:select",function(e,t){this.$el.find(":checkbox").prop("checked",t).change()})},enterEditMode:function(){this.$el.find(":checkbox").focus()},exitEditMode:function(){this.$el.find(":checkbox").blur()},onKeydown:function(e){var t=new d.Command(e);return t.passThru()?!0:(t.cancel()?(e.stopPropagation(),this.$el.find(":checkbox").blur()):(t.save()||t.moveLeft()||t.moveRight()||t.moveUp()||t.moveDown())&&(e.preventDefault(),e.stopPropagation(),this.model.trigger("backgrid:edited",this.model,this.column,t)),void 0)},onChange:function(e){this.model.trigger("backgrid:selected",this.model,l(e.target).prop("checked")),this.grid.trigger("backgrid:selectedrowschanged")},render:function(){return this.$el.empty().append('<input tabindex="-1" type="checkbox" />'),this.delegateEvents(),this}}),P=d.Extension.SelectAllHeaderCell=_.extend({className:"select-all-header-cell",tagName:"th",initialize:function(e){this.grid=e.grid,d.requireOptions(e,["column","collection"]),this.column=e.column,this.column instanceof d.Column||(this.column=new d.Column(this.column));var t=this.collection,i=this.selectedModels={};this.listenTo(t,"backgrid:selected",function(e,t){t?i[e.id||e.cid]=e:(delete i[e.id||e.cid],this.$el.find(":checkbox").prop("checked",!1))}),this.listenTo(t,"remove",function(e){delete i[e.cid]}),this.listenTo(t,"backgrid:refresh",function(){this.$el.find(":checkbox").prop("checked",!1);for(var e=0;t.length>e;e++){var n=t.at(e);i[n.id||n.cid]&&n.trigger("backgrid:select",n,!0)}})},onChange:function(e){var t=l(e.target).prop("checked"),i=this.collection;i.each(function(e){e.trigger("backgrid:select",e,t)}),this.grid.trigger("backgrid:selectedrowschanged")}});d.Grid.prototype.getSelectedModels=function(){for(var e,t=this.header.row.cells,i=0,n=t.length;n>i;i++){var r=t[i];if(r instanceof P){e=r;break}}var o=[];if(e)for(var s in e.selectedModels)o.push(this.collection.get(s));return o},function(e,t,i,n){"use strict";var r=n.Extension.ServerSideFilter=i.View.extend({tagName:"form",className:"backgrid-filter form-search",template:t.template('<div class="input-prepend input-append"><!--span class="add-on"><i class="icon-search"></i></span--><input type="text" <% if (placeholder) { %> placeholder="<%- placeholder %>" <% } %> name="<%- name %>" /><span class="add-on"><a class="close" href="#">&times;</a></span></div>'),events:{"click .close":"clear",submit:"search"},name:"q",placeholder:null,initialize:function(e){n.requireOptions(e,["collection"]),i.View.prototype.initialize.apply(this,arguments),this.name=e.name||this.name,this.placeholder=e.placeholder||this.placeholder;var t=this.collection,r=this;i.PageableCollection&&t instanceof i.PageableCollection&&"server"==t.mode&&(t.queryParams[this.name]=function(){return r.$el.find("input[type=text]").val()})},search:function(e){e&&e.preventDefault();var t={};t[this.name]=this.$el.find("input[type=text]").val(),this.collection.fetch({data:t})},clear:function(e){e&&e.preventDefault(),this.$("input[type=text]").val(null),this.collection.fetch()},render:function(){return this.$el.empty().append(this.template({name:this.name,placeholder:this.placeholder,value:this.value})),this.delegateEvents(),this}});n.Extension.ClientSideFilter=r.extend({events:{"click .close":function(e){e.preventDefault(),this.clear()},"change input[type=text]":"search","keyup input[type=text]":"search",submit:function(e){e.preventDefault(),this.search()}},fields:null,wait:149,initialize:function(e){r.prototype.initialize.apply(this,arguments),this.fields=e.fields||this.fields,this.wait=e.wait||this.wait,this._debounceMethods(["search","clear"]);var i=this.collection,n=this.shadowCollection=i.clone();n.url=i.url,n.sync=i.sync,n.parse=i.parse,this.listenTo(i,"add",function(e,t,i){n.add(e,i)}),this.listenTo(i,"remove",function(e,t,i){n.remove(e,i)}),this.listenTo(i,"sort reset",function(e,i){i=t.extend({reindex:!0},i||{}),i.reindex&&n.reset(e.models)})},_debounceMethods:function(e){t.isString(e)&&(e=[e]),this.undelegateEvents();for(var i=0,n=e.length;n>i;i++){var r=e[i],o=this[r];this[r]=t.debounce(o,this.wait)}this.delegateEvents()},makeMatcher:function(e){var t=RegExp(e.trim(),"i");return function(e){for(var i=this.fields||e.keys(),n=0,r=i.length;r>n;n++)if(t.test(""+e.get(i[n])))return!0;return!1}},search:function(){var e=t.bind(this.makeMatcher(this.$("input[type=text]").val()),this);this.collection.reset(this.shadowCollection.filter(e),{reindex:!1})},clear:function(){this.$("input[type=text]").val(null),this.collection.reset(this.shadowCollection.models,{reindex:!1})}})}(jQuery,s,o,d,lunr),function(e,t,i,n){"use strict";n.Extension.Paginator=i.View.extend({className:"backgrid-paginator",windowSize:10,fastForwardHandleLabels:{first:"《",prev:"〈",next:"〉",last:"》"},template:t.template('<ul><% _.each(handles, function (handle) { %><li <% if (handle.className) { %>class="<%= handle.className %>"<% } %>><a href="#" <% if (handle.title) {%> title="<%= handle.title %>"<% } %>><%= handle.label %></a></li><% }); %></ul>'),events:{"click a":"changePage"},initialize:function(e){n.requireOptions(e,["collection"]);var t=this.collection,i=t.fullCollection;i?(this.listenTo(i,"add",this.render),this.listenTo(i,"remove",this.render),this.listenTo(i,"reset",this.render)):(this.listenTo(t,"add",this.render),this.listenTo(t,"remove",this.render),this.listenTo(t,"reset",this.render))},changePage:function(t){t.preventDefault();var i=e(t.target).parent();if(!i.hasClass("active")&&!i.hasClass("disabled")){var n=e(t.target).text(),r=this.fastForwardHandleLabels,o=this.collection;if(r)switch(n){case r.first:return o.getFirstPage(),void 0;case r.prev:return o.getPreviousPage(),void 0;case r.next:return o.getNextPage(),void 0;case r.last:return o.getLastPage(),void 0}var s=o.state,l=+n;o.getPage(0===s.firstPage?l-1:l)}},makeHandles:function(){var e=[],t=this.collection,i=t.state,n=i.firstPage,r=+i.lastPage;r=Math.max(0,n?r-1:r);var o=Math.max(i.currentPage,i.firstPage);o=n?o-1:o;var s=Math.floor(o/this.windowSize)*this.windowSize,l=Math.min(r+1,s+this.windowSize);if("infinite"!==t.mode)for(var a=s;l>a;a++)e.push({label:a+1,title:"No. "+(a+1),className:o===a?"active":void 0});var c=this.fastForwardHandleLabels;return c&&(c.prev&&e.unshift({label:c.prev,className:t.hasPrevious()?void 0:"disabled"}),c.first&&e.unshift({label:c.first,className:t.hasPrevious()?void 0:"disabled"}),c.next&&e.push({label:c.next,className:t.hasNext()?void 0:"disabled"}),c.last&&e.push({label:c.last,className:t.hasNext()?void 0:"disabled"})),e},render:function(){return this.$el.empty(),this.$el.append(this.template({handles:this.makeHandles()})),this.delegateEvents(),this}})}(jQuery,s,o,d),function(e,t,i,n,r){var o=r.Extension.TextareaEditor=r.CellEditor.extend({tagName:"div",className:"modal hide fade",template:i.template('<form><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h3><%- column.get("label") %></h3></div><div class="modal-body"><textarea cols="<%= cols %>" rows="<%= rows %>"><%- content %></textarea></div><div class="modal-footer"><input class="btn" type="submit" value="Save"/></div></form>'),cols:80,rows:10,events:{"keydown textarea":"clearError",submit:"saveOrCancel",hide:"saveOrCancel",hidden:"close",shown:"focus"},modalOptions:{backdrop:!1},render:function(){return this.$el.html(t(this.template({column:this.column,cols:this.cols,rows:this.rows,content:this.formatter.fromRaw(this.model.get(this.column.get("name")))}))),this.delegateEvents(),this.$el.modal(this.modalOptions),this},saveOrCancel:function(t){t&&"submit"==t.type&&(t.preventDefault(),t.stopPropagation());var n=this.model,r=this.column,o=this.$el.find("textarea").val(),s=this.formatter.toRaw(o);i.isUndefined(s)?(n.trigger("backgrid:error",n,r,o),t&&(t.preventDefault(),t.stopPropagation())):!t||"submit"==t.type||"hide"==t.type&&s!==(this.model.get(this.column.get("name"))||"").replace(/\r/g,"")&&e.confirm("Would you like to save your changes?")?(n.set(r.get("name"),s),this.$el.modal("hide")):"hide"!=t.type&&this.$el.modal("hide")},clearError:i.debounce(function(){i.isUndefined(this.formatter.toRaw(this.$el.find("textarea").val()))||this.$el.parent().removeClass("error")},150),close:function(e){var t=this.model;t.trigger("backgrid:edited",t,this.column,new r.Command(e))},focus:function(){this.$el.find("textarea").focus()}});r.Extension.TextCell=r.StringCell.extend({className:"text-cell",editor:o})}(window,jQuery,s,o,d),i.exports=d});
